<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geocoding API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        h2 { color: #666; margin-top: 30px; }
        button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #4f46e5; }
        input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 150px;
            margin: 5px;
        }
        pre {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #22c55e; font-weight: bold; }
        .error { color: #ef4444; font-weight: bold; }
        .loading { color: #3b82f6; }
    </style>
</head>
<body>
    <h1>üåç Geocoding API Test Tool</h1>
    
    <div class="test-box">
        <h2>Enter Coordinates</h2>
        <p>Test coordinates: Manila (14.5995, 120.9842), Bohol (9.8499, 124.1435)</p>
        <input type="number" id="lat" placeholder="Latitude" step="any" value="14.5995">
        <input type="number" id="lon" placeholder="Longitude" step="any" value="120.9842">
        <button onclick="testAllAPIs()">Test All APIs</button>
        <button onclick="getCurrentLocation()">Use My Location</button>
    </div>

    <div id="results"></div>

    <script>
        async function testAllAPIs() {
            const lat = document.getElementById('lat').value;
            const lon = document.getElementById('lon').value;
            
            const results = document.getElementById('results');
            results.innerHTML = '<div class="loading">Testing APIs...</div>';

            // Test Photon API
            await testPhoton(lat, lon);
            
            // Test Nominatim API
            await testNominatim(lat, lon);
            
            // Test Google Geocoding (if you add an API key)
            await testGoogle(lat, lon);
        }

        async function testPhoton(lat, lon) {
            const container = document.createElement('div');
            container.className = 'test-box';
            container.innerHTML = '<h2>Photon API (komoot.io)</h2><div class="loading">Testing...</div>';
            document.getElementById('results').appendChild(container);

            try {
                const url = `https://photon.komoot.io/reverse?lat=${encodeURIComponent(lat)}&lon=${encodeURIComponent(lon)}`;
                const startTime = Date.now();
                const response = await fetch(url, { headers: { 'Accept': 'application/json' } });
                const elapsed = Date.now() - startTime;
                
            if (response.ok) {
                const data = await response.json();
                
                // Photon returns features array
                let address = '';
                if (data.features && data.features.length > 0) {
                    address = extractPhotonAddress(data.features[0].properties);
                }
                
                container.innerHTML = `
                    <h2>‚úÖ Photon API (${elapsed}ms)</h2>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                    <p class="success">Status: ${response.status}</p>
                    ${address ? `<p><strong>Address:</strong> ${address}</p>` : '<p>No address data found</p>'}
                `;
            } else {
                container.innerHTML = `<h2>‚ùå Photon API Failed</h2><p class="error">HTTP ${response.status}</p>`;
            }
            } catch (error) {
                container.innerHTML = `<h2>‚ùå Photon API Error</h2><pre class="error">${error.message}</pre>`;
            }
        }

        async function testNominatim(lat, lon) {
            const container = document.createElement('div');
            container.className = 'test-box';
            container.innerHTML = '<h2>Nominatim API (OpenStreetMap)</h2><div class="loading">Testing...</div>';
            document.getElementById('results').appendChild(container);

            try {
                const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${encodeURIComponent(lat)}&lon=${encodeURIComponent(lon)}`;
                const startTime = Date.now();
                const response = await fetch(url, { headers: { 'Accept': 'application/json' } });
                const elapsed = Date.now() - startTime;
                
                if (response.ok) {
                    const data = await response.json();
                    container.innerHTML = `
                        <h2>‚úÖ Nominatim API (${elapsed}ms)</h2>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                        <p class="success">Status: ${response.status}</p>
                        ${data.address ? `<p><strong>Address:</strong> ${extractNominatimAddress(data.address)}</p>` : ''}
                    `;
                } else {
                    container.innerHTML = `<h2>‚ùå Nominatim API Failed</h2><p class="error">HTTP ${response.status}</p>`;
                }
            } catch (error) {
                container.innerHTML = `<h2>‚ùå Nominatim API Error</h2><pre class="error">${error.message}</pre>`;
            }
        }

        async function testGoogle(lat, lon) {
            const container = document.createElement('div');
            container.className = 'test-box';
            container.innerHTML = '<h2>Google Geocoding API (Requires API Key)</h2><div class="loading">Skipping (No API Key configured)</div>';
            document.getElementById('results').appendChild(container);

            // Uncomment and add your API key to test
            /*
            try {
                const apiKey = 'YOUR_API_KEY_HERE';
                const url = `https://maps.googleapis.com/maps/api/geocode/json?latlng=${lat},${lon}&key=${apiKey}`;
                const startTime = Date.now();
                const response = await fetch(url);
                const elapsed = Date.now() - startTime;
                
                if (response.ok) {
                    const data = await response.json();
                    container.innerHTML = `
                        <h2>‚úÖ Google API (${elapsed}ms)</h2>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                        <p class="success">Status: ${response.status}</p>
                    `;
                } else {
                    container.innerHTML = `<h2>‚ùå Google API Failed</h2><p class="error">HTTP ${response.status}</p>`;
                }
            } catch (error) {
                container.innerHTML = `<h2>‚ùå Google API Error</h2><pre class="error">${error.message}</pre>`;
            }
            */
        }

        function extractPhotonAddress(props) {
            const parts = [];
            if (props.street || props.name) parts.push(props.street || props.name);
            if (props.city || props.town || props.municipality) parts.push(props.city || props.town || props.municipality);
            if (props.state) parts.push(props.state);
            if (props.postcode) parts.push(props.postcode);
            if (props.country) parts.push(props.country);
            return parts.join(', ') || 'Address not found';
        }

        function extractNominatimAddress(addr) {
            const parts = [];
            if (addr.house_number) parts.push(addr.house_number);
            if (addr.road) parts.push(addr.road);
            if (addr.city || addr.town || addr.village) parts.push(addr.city || addr.town || addr.village);
            if (addr.state) parts.push(addr.state);
            if (addr.postcode) parts.push(addr.postcode);
            if (addr.country) parts.push(addr.country);
            return parts.join(', ') || 'Address not found';
        }

        function getCurrentLocation() {
            if (!navigator.geolocation) {
                alert('Geolocation is not supported by this browser.');
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    document.getElementById('lat').value = position.coords.latitude;
                    document.getElementById('lon').value = position.coords.longitude;
                    testAllAPIs();
                },
                (error) => {
                    alert('Error getting location: ' + error.message);
                }
            );
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            testAllAPIs();
        });
    </script>
</body>
</html>

